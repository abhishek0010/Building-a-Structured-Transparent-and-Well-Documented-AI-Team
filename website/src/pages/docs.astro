---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Documentation">
  <section class="py-20">
    <div class="max-w-4xl mx-auto px-6">
      <div class="text-center mb-16">
        <h1 class="font-display text-4xl lg:text-5xl font-bold text-stone-900 mb-6">
          Documentation
        </h1>
        <p class="text-xl text-stone-600">
          Core concepts, contracts, and protocols that power the multi-agent framework.
        </p>
      </div>

      <!-- Table of Contents -->
      <div class="bg-stone-50 rounded-xl p-6 mb-16">
        <h2 class="font-display text-lg font-semibold text-stone-900 mb-4">Contents</h2>
        <ul class="space-y-2 text-stone-600">
          <li><a href="#runs-and-steps" class="hover:text-copper transition-colors">‚Üí Runs and Steps</a></li>
          <li><a href="#boomerang-protocol" class="hover:text-copper transition-colors">‚Üí Boomerang Protocol</a></li>
          <li><a href="#role-contracts" class="hover:text-copper transition-colors">‚Üí Role Contracts</a></li>
          <li><a href="#tdd-workflow" class="hover:text-copper transition-colors">‚Üí TDD Workflow</a></li>
          <li><a href="#parallel-execution" class="hover:text-copper transition-colors">‚Üí Parallel Execution</a></li>
          <li><a href="#task-maps" class="hover:text-copper transition-colors">‚Üí Task Maps</a></li>
        </ul>
      </div>

      <!-- Runs and Steps -->
      <div id="runs-and-steps" class="mb-16 scroll-mt-24">
        <h2 class="font-display text-2xl font-bold text-stone-900 mb-6">Runs and Steps</h2>
        <p class="text-stone-600 mb-6">
          All agents operate as part of a structured runtime. Each unit of work is organized into runs and steps.
        </p>
        
        <div class="bg-white rounded-xl border border-stone-200 p-6 mb-6">
          <h3 class="font-semibold text-stone-900 mb-4">Run Structure</h3>
          <div class="bg-stone-900 rounded-lg p-4 overflow-x-auto">
            <pre class="text-stone-300 text-sm"><code>{`{
  "run_id": "uuid-v7",
  "objective": "Implement user authentication",
  "status": "running",  // pending | running | completed | failed | blocked
  "steps": [
    { "type": "reasoning", "content": "Analyzing requirements..." },
    { "type": "tool", "name": "read_file", "params": {...} },
    { "type": "delegate", "to": "code", "task": {...} }
  ]
}`}</code></pre>
          </div>
        </div>

        <div class="grid md:grid-cols-3 gap-4">
          <div class="bg-stone-50 rounded-lg p-4">
            <h4 class="font-semibold text-stone-900 mb-2">reasoning</h4>
            <p class="text-sm text-stone-600">Internal planning and analysis steps</p>
          </div>
          <div class="bg-stone-50 rounded-lg p-4">
            <h4 class="font-semibold text-stone-900 mb-2">tool</h4>
            <p class="text-sm text-stone-600">Real tool invocation (file ops, MCP, etc.)</p>
          </div>
          <div class="bg-stone-50 rounded-lg p-4">
            <h4 class="font-semibold text-stone-900 mb-2">delegate</h4>
            <p class="text-sm text-stone-600">Assign work to another agent mode</p>
          </div>
        </div>
      </div>

      <!-- Boomerang Protocol -->
      <div id="boomerang-protocol" class="mb-16 scroll-mt-24">
        <h2 class="font-display text-2xl font-bold text-stone-900 mb-6">Boomerang Protocol</h2>
        <p class="text-stone-600 mb-6">
          Any agent receiving a delegated task returns a structured payload to the orchestrator.
        </p>
        
        <div class="bg-white rounded-xl border border-stone-200 p-6 mb-6">
          <h3 class="font-semibold text-stone-900 mb-4">Return Payload Schema</h3>
          <div class="bg-stone-900 rounded-lg p-4 overflow-x-auto">
            <pre class="text-stone-300 text-sm"><code>{`{
  "type": "task-completed",  // or escalation | review-approved | review-rejected
  "task_id": "task-001",
  "run_id": "run-uuid",
  "from": "code",
  "to": "orchestrator",
  "status": "success",  // success | failed | blocked
  "files_changed": ["src/auth.ts", "tests/auth.test.ts"],
  "tests_run": ["npm test -- auth"],
  "summary": "Implemented JWT authentication with refresh tokens",
  "notes": "Consider adding rate limiting in future iteration"
}`}</code></pre>
          </div>
        </div>

        <div class="bg-amber-50 border border-amber-200 rounded-lg p-4">
          <div class="flex gap-3">
            <svg class="w-5 h-5 text-amber-600 shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
            </svg>
            <div>
              <h4 class="font-semibold text-amber-800">Escalation</h4>
              <p class="text-sm text-amber-700">When blocked, use <code class="bg-amber-100 px-1 rounded">type: "escalation"</code> and describe what blocked you, what you attempted, and concrete options for resolution.</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Role Contracts -->
      <div id="role-contracts" class="mb-16 scroll-mt-24">
        <h2 class="font-display text-2xl font-bold text-stone-900 mb-6">Role Contracts</h2>
        <p class="text-stone-600 mb-6">
          Each agent role has specific responsibilities and constraints.
        </p>
        
        <div class="space-y-6">
          <div class="bg-white rounded-xl border border-stone-200 p-6">
            <h3 class="font-display text-lg font-semibold text-stone-900 mb-4 flex items-center gap-2">
              <span class="text-xl">üîÑ</span> Orchestrator
            </h3>
            <div class="grid md:grid-cols-2 gap-6">
              <div>
                <h4 class="font-semibold text-green-700 mb-2">MUST</h4>
                <ul class="space-y-1 text-sm text-stone-600">
                  <li>‚Ä¢ Interpret user goals and constraints</li>
                  <li>‚Ä¢ Create and maintain Task Maps</li>
                  <li>‚Ä¢ Decompose work into atomic subtasks</li>
                  <li>‚Ä¢ Assign workspace_path and file_patterns</li>
                  <li>‚Ä¢ Consume boomerang payloads</li>
                </ul>
              </div>
              <div>
                <h4 class="font-semibold text-red-700 mb-2">MUST NOT</h4>
                <ul class="space-y-1 text-sm text-stone-600">
                  <li>‚Ä¢ Directly edit project files</li>
                  <li>‚Ä¢ Run destructive commands</li>
                  <li>‚Ä¢ Bypass contracts</li>
                </ul>
              </div>
            </div>
          </div>

          <div class="bg-white rounded-xl border border-stone-200 p-6">
            <h3 class="font-display text-lg font-semibold text-stone-900 mb-4 flex items-center gap-2">
              <span class="text-xl">üíª</span> Worker (Code, Red/Green/Blue Phase)
            </h3>
            <div class="grid md:grid-cols-2 gap-6">
              <div>
                <h4 class="font-semibold text-green-700 mb-2">MUST</h4>
                <ul class="space-y-1 text-sm text-stone-600">
                  <li>‚Ä¢ Operate within assigned workspace_path</li>
                  <li>‚Ä¢ Respect file_patterns constraints</li>
                  <li>‚Ä¢ Implement exactly the subtask objective</li>
                  <li>‚Ä¢ Add/update tests when appropriate</li>
                  <li>‚Ä¢ Return boomerang payloads</li>
                </ul>
              </div>
              <div>
                <h4 class="font-semibold text-red-700 mb-2">MUST NOT</h4>
                <ul class="space-y-1 text-sm text-stone-600">
                  <li>‚Ä¢ Modify files outside scope</li>
                  <li>‚Ä¢ Ignore acceptance criteria</li>
                  <li>‚Ä¢ Silently expand scope</li>
                </ul>
              </div>
            </div>
          </div>

          <div class="bg-white rounded-xl border border-stone-200 p-6">
            <h3 class="font-display text-lg font-semibold text-stone-900 mb-4 flex items-center gap-2">
              <span class="text-xl">üëÅÔ∏è</span> Reviewer
            </h3>
            <div class="grid md:grid-cols-2 gap-6">
              <div>
                <h4 class="font-semibold text-green-700 mb-2">MUST</h4>
                <ul class="space-y-1 text-sm text-stone-600">
                  <li>‚Ä¢ Be read-only</li>
                  <li>‚Ä¢ Review only relevant changes</li>
                  <li>‚Ä¢ Return review-approved or review-rejected</li>
                  <li>‚Ä¢ Provide structured feedback</li>
                </ul>
              </div>
              <div>
                <h4 class="font-semibold text-red-700 mb-2">MUST NOT</h4>
                <ul class="space-y-1 text-sm text-stone-600">
                  <li>‚Ä¢ Edit files</li>
                  <li>‚Ä¢ Provide vague approvals</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- TDD Workflow -->
      <div id="tdd-workflow" class="mb-16 scroll-mt-24">
        <h2 class="font-display text-2xl font-bold text-stone-900 mb-6">TDD Workflow</h2>
        <p class="text-stone-600 mb-6">
          The framework enforces Test-Driven Development through three distinct phases:
        </p>
        
        <div class="space-y-6">
          <div class="bg-red-50 rounded-xl p-6 border border-red-100">
            <div class="flex items-center gap-4 mb-4">
              <div class="w-12 h-12 bg-red-100 rounded-xl flex items-center justify-center text-2xl">üî¥</div>
              <div>
                <h3 class="font-display text-lg font-semibold text-stone-900">Red Phase</h3>
                <p class="text-sm text-red-700">Tests must fail with clear messages</p>
              </div>
            </div>
            <ul class="space-y-2 text-sm text-stone-600">
              <li>‚Ä¢ Write test specifications before implementation</li>
              <li>‚Ä¢ Define expected behavior through assertions</li>
              <li>‚Ä¢ Create test fixtures and mocks</li>
              <li>‚Ä¢ Verify tests fail for the right reasons</li>
            </ul>
          </div>

          <div class="bg-green-50 rounded-xl p-6 border border-green-100">
            <div class="flex items-center gap-4 mb-4">
              <div class="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center text-2xl">üü¢</div>
              <div>
                <h3 class="font-display text-lg font-semibold text-stone-900">Green Phase</h3>
                <p class="text-sm text-green-700">Write minimal code focused on correctness</p>
              </div>
            </div>
            <ul class="space-y-2 text-sm text-stone-600">
              <li>‚Ä¢ Implement just enough to pass tests</li>
              <li>‚Ä¢ No premature optimization</li>
              <li>‚Ä¢ All red phase tests must turn green</li>
              <li>‚Ä¢ Quick iterations toward passing state</li>
            </ul>
          </div>

          <div class="bg-blue-50 rounded-xl p-6 border border-blue-100">
            <div class="flex items-center gap-4 mb-4">
              <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center text-2xl">üîµ</div>
              <div>
                <h3 class="font-display text-lg font-semibold text-stone-900">Blue Phase</h3>
                <p class="text-sm text-blue-700">Improve quality while maintaining passing tests</p>
              </div>
            </div>
            <ul class="space-y-2 text-sm text-stone-600">
              <li>‚Ä¢ Refactor for readability and maintainability</li>
              <li>‚Ä¢ Optimize performance where needed</li>
              <li>‚Ä¢ Polish output formatting</li>
              <li>‚Ä¢ Tests must remain green throughout</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Parallel Execution -->
      <div id="parallel-execution" class="mb-16 scroll-mt-24">
        <h2 class="font-display text-2xl font-bold text-stone-900 mb-6">Parallel Execution</h2>
        <p class="text-stone-600 mb-6">
          Parallelism is allowed only when safe by construction through workspace and file isolation.
        </p>
        
        <div class="bg-white rounded-xl border border-stone-200 p-6 mb-6">
          <h3 class="font-semibold text-stone-900 mb-4">Safety Rules</h3>
          <ul class="space-y-3 text-stone-600">
            <li class="flex items-start gap-3">
              <svg class="w-5 h-5 text-green-600 shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
              </svg>
              <span><strong>Non-overlapping workspace_path:</strong> Tasks with different workspace roots can run in parallel</span>
            </li>
            <li class="flex items-start gap-3">
              <svg class="w-5 h-5 text-green-600 shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
              </svg>
              <span><strong>Disjoint file_patterns:</strong> Tasks with non-conflicting file patterns in the same workspace can run in parallel</span>
            </li>
            <li class="flex items-start gap-3">
              <svg class="w-5 h-5 text-red-600 shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
              </svg>
              <span><strong>Any doubt = conflict:</strong> Serialize or rescope to eliminate potential race conditions</span>
            </li>
          </ul>
        </div>

        <div class="bg-stone-900 rounded-xl p-6 overflow-x-auto">
          <pre class="text-stone-300 text-sm"><code>{`// Example: Parallel-safe task assignment
{
  "tasks": [
    {
      "task_id": "frontend-auth",
      "mode": "code",
      "workspace_path": "src/components/",
      "file_patterns": ["Auth*.tsx", "Login*.tsx"]
    },
    {
      "task_id": "backend-auth", 
      "mode": "code",
      "workspace_path": "src/api/",
      "file_patterns": ["auth*.ts", "jwt*.ts"]
    }
  ]
  // These can run in parallel - different workspace_path values
}`}</code></pre>
        </div>
      </div>

      <!-- Task Maps -->
      <div id="task-maps" class="mb-16 scroll-mt-24">
        <h2 class="font-display text-2xl font-bold text-stone-900 mb-6">Task Maps</h2>
        <p class="text-stone-600 mb-6">
          Planner generates Task Maps that define the complete scope of work with dependencies.
        </p>
        
        <div class="bg-white rounded-xl border border-stone-200 p-6 mb-6">
          <h3 class="font-semibold text-stone-900 mb-4">Task Map Structure</h3>
          <div class="bg-stone-900 rounded-lg p-4 overflow-x-auto">
            <pre class="text-stone-300 text-sm"><code>{`{
  "objective": "Implement user authentication system",
  "tasks": [
    {
      "task_id": "auth-001",
      "title": "Design auth schema",
      "mode": "architect",
      "deps": [],
      "acceptance_criteria": [
        "ADR documenting auth approach",
        "Database schema for users table",
        "API contract for auth endpoints"
      ]
    },
    {
      "task_id": "auth-002", 
      "title": "Write auth tests",
      "mode": "red-phase",
      "deps": ["auth-001"],
      "workspace_path": "tests/",
      "file_patterns": ["auth.test.ts"]
    },
    {
      "task_id": "auth-003",
      "title": "Implement auth",
      "mode": "green-phase", 
      "deps": ["auth-002"],
      "workspace_path": "src/",
      "file_patterns": ["auth/*.ts"]
    }
  ]
}`}</code></pre>
          </div>
        </div>
      </div>

      <!-- Resources -->
      <div class="bg-stone-900 rounded-2xl p-8 text-stone-50">
        <h2 class="font-display text-2xl font-bold mb-6">Additional Resources</h2>
        <div class="grid md:grid-cols-2 gap-6">
          <a href="https://github.com/Mnehmos/mnehmos.multi-agent.framework" class="bg-stone-800 rounded-xl p-6 hover:bg-stone-700 transition-colors">
            <h3 class="font-semibold mb-2">GitHub Repository</h3>
            <p class="text-sm text-stone-400">Full source code, templates, and examples</p>
          </a>
          <a href="/mnehmos.multi-agent.framework/team" class="bg-stone-800 rounded-xl p-6 hover:bg-stone-700 transition-colors">
            <h3 class="font-semibold mb-2">Agent Reference</h3>
            <p class="text-sm text-stone-400">Detailed capabilities for each agent</p>
          </a>
          <a href="/mnehmos.multi-agent.framework/tools" class="bg-stone-800 rounded-xl p-6 hover:bg-stone-700 transition-colors">
            <h3 class="font-semibold mb-2">MCP Tools</h3>
            <p class="text-sm text-stone-400">Extend capabilities with MCP servers</p>
          </a>
          <a href="/mnehmos.multi-agent.framework/templates" class="bg-stone-800 rounded-xl p-6 hover:bg-stone-700 transition-colors">
            <h3 class="font-semibold mb-2">IDE Templates</h3>
            <p class="text-sm text-stone-400">Pre-configured setups for your editor</p>
          </a>
        </div>
      </div>
    </div>
  </section>
</Layout>
